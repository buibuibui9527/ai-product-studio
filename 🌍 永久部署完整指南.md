# 🌍 永久部署完整指南

本文件提供了將 **AI Product Studio** 轉換為永久運行網站的完整步驟。

---

## 📊 部署架構概覽

```
┌─────────────────────────────────────────────────────────────┐
│                     您的自訂網域                              │
│              (例如: yoursite.com)                            │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                    Vercel (CDN + Hosting)                   │
│  ✓ 全球加速      ✓ 自動擴展      ✓ 免費 SSL                 │
└────────────────────┬────────────────────────────────────────┘
                     │
         ┌───────────┼───────────┐
         ▼           ▼           ▼
    ┌────────┐  ┌──────────┐  ┌────────────┐
    │Supabase│  │Replicate │  │Lemon Squeezy│
    │(DB)    │  │(AI)      │  │(Payment)   │
    └────────┘  └──────────┘  └────────────┘
```

---

## 🎯 快速開始（5 分鐘）

### 步驟 1：準備 GitHub 倉庫

```bash
# 在您的電腦上執行
cd /path/to/ai-product-saas

# 初始化 Git（如果還沒有的話）
git init
git add .
git commit -m "Initial commit: AI Product Studio"

# 推送到 GitHub
git remote add origin https://github.com/YOUR_USERNAME/ai-product-studio.git
git branch -M main
git push -u origin main
```

### 步驟 2：在 Vercel 上部署

1. 前往 https://vercel.com/dashboard
2. 點擊「Add New...」→「Project」
3. 選擇「Import Git Repository」
4. 搜尋 `ai-product-studio` 並導入
5. 在「Environment Variables」中填入所有金鑰（見下方）
6. 點擊「Deploy」

### 步驟 3：配置環境變數

在 Vercel 中設定以下環境變數：

```
NEXT_PUBLIC_SITE_URL = https://your-domain.vercel.app
NEXT_PUBLIC_SUPABASE_URL = https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY = eyJhbGc...
SUPABASE_SERVICE_ROLE_KEY = eyJhbGc...
REPLICATE_API_TOKEN = r8_xxx...
LEMON_SQUEEZY_API_KEY = (可選)
LEMON_SQUEEZY_WEBHOOK_SECRET = (可選)
```

### 步驟 4：更新 Supabase OAuth

1. 登入 Supabase
2. 前往 **Authentication** → **URL Configuration**
3. 設定 **Site URL** 為您的 Vercel 網域
4. 新增 **Redirect URL**：`https://your-domain.vercel.app/auth/callback`
5. 保存

---

## 🔑 環境變數詳細說明

### 必需變數

| 變數 | 來源 | 說明 |
|------|------|------|
| `NEXT_PUBLIC_SITE_URL` | Vercel | 您部署的網域 |
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase Settings > API | 專案 URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase Settings > API | Anon Key |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase Settings > API | Service Role Key |
| `REPLICATE_API_TOKEN` | Replicate Account > API Tokens | API Token |

### 可選變數

| 變數 | 來源 | 說明 |
|------|------|------|
| `LEMON_SQUEEZY_API_KEY` | Lemon Squeezy Settings > API | 用於付費功能 |
| `LEMON_SQUEEZY_WEBHOOK_SECRET` | Lemon Squeezy Webhooks | Webhook 驗證 |

---

## 🌐 自訂網域設定

### 使用 Vercel 提供的網域

Vercel 會自動為您生成一個免費網域（例如 `ai-product-studio.vercel.app`）。

### 使用自己的網域

1. **購買網域**（例如 GoDaddy、Namecheap、Google Domains）

2. **在 Vercel 中新增網域**
   - 前往專案設定 → **Domains**
   - 點擊「Add」
   - 輸入您的網域名稱

3. **更新 DNS 記錄**
   - Vercel 會提供 DNS 記錄
   - 在您的網域提供商中新增這些記錄
   - 等待 DNS 傳播（通常 5-48 小時）

4. **更新環境變數**
   - 編輯 `NEXT_PUBLIC_SITE_URL` 為您的自訂網域
   - 重新部署

5. **更新 Supabase OAuth**
   - 更新 Site URL 為您的自訂網域
   - 更新 Redirect URL

---

## ✅ 驗證部署

部署完成後，請按照以下步驟驗證：

### 1. 檢查網站可訪問性
```bash
curl -I https://your-domain.vercel.app
# 應該返回 200 OK
```

### 2. 測試完整流程
- 訪問網站
- 點擊「Sign in with Google」
- 登入並進入 Dashboard
- 上傳圖片並測試 AI 功能

### 3. 檢查 Vercel 日誌
- 在 Vercel 專案中，前往 **Logs**
- 確認沒有錯誤訊息

---

## 🔄 持續部署與更新

### 自動部署

一旦連接了 GitHub，Vercel 會自動部署：

```bash
# 在本地開發
git add .
git commit -m "Add new feature"
git push origin main

# Vercel 自動構建和部署
# 通常在 1-2 分鐘內完成
```

### 手動重新部署

如果需要手動重新部署：

1. 前往 Vercel 專案
2. 點擊「Deployments」
3. 選擇一個部署
4. 點擊「Redeploy」

---

## 📈 監控與維護

### 查看日誌

```bash
# 在 Vercel 中
1. 前往 Logs
2. 選擇 Function 或 Build
3. 查看實時日誌
```

### 監控效能

```bash
# 在 Vercel 中
1. 前往 Analytics
2. 查看流量、錯誤率、響應時間
```

### 設定告警

1. 前往 Vercel 專案設定
2. 選擇「Alerts」
3. 設定錯誤率或響應時間告警

---

## 🛡️ 安全性最佳實踐

### 1. 環境變數安全
- ✅ 永遠不要在代碼中硬編碼密鑰
- ✅ 使用 Vercel 的環境變數管理
- ✅ 定期輪換 API 金鑰

### 2. 資料庫安全
- ✅ 啟用 Supabase Row Level Security (RLS)
- ✅ 使用 Service Role Key 僅在伺服器端
- ✅ 定期備份資料庫

### 3. API 安全
- ✅ 實施 Rate Limiting（已包含）
- ✅ 驗證所有 Webhook 簽名
- ✅ 使用 HTTPS（Vercel 自動提供）

---

## 🐛 常見問題與解決方案

### Q: 部署後出現 500 錯誤
**A:** 
1. 檢查所有環境變數是否正確設定
2. 查看 Vercel 的 Logs 尋找詳細錯誤
3. 確認 Supabase 資料庫已正確設定

### Q: Google 登入不工作
**A:**
1. 確認 Supabase OAuth Redirect URL 與部署網域一致
2. 確認 Google OAuth Client ID 和 Secret 正確
3. 檢查 Supabase 的 Authentication 設定

### Q: AI 功能返回 500 錯誤
**A:**
1. 確認 `REPLICATE_API_TOKEN` 正確設定
2. 檢查 Replicate 帳號是否有足夠額度
3. 查看 Vercel Logs 中的詳細錯誤

### Q: 如何回滾到之前的版本？
**A:**
1. 在 Vercel 的 Deployments 中找到之前的部署
2. 點擊「Redeploy」
3. 或在 GitHub 中回滾代碼並推送

### Q: 如何增加 Replicate 額度？
**A:**
1. 登入 Replicate
2. 前往 Account > Billing
3. 新增付款方式
4. 設定月度額度限制

---

## 📞 支援資源

- **Vercel 文件**：https://vercel.com/docs
- **Next.js 文件**：https://nextjs.org/docs
- **Supabase 文件**：https://supabase.com/docs
- **Replicate 文件**：https://replicate.com/docs

---

## 🎉 成功指標

當您看到以下情況時，表示部署成功：

✅ 網站在自訂網域上可訪問  
✅ Google 登入正常工作  
✅ Dashboard 能正確載入  
✅ 能成功上傳圖片  
✅ AI 功能能正確處理圖片  
✅ Vercel Logs 中沒有錯誤  

---

## 🚀 下一步

1. **監控效能**：定期檢查 Vercel Analytics
2. **收集反饋**：向用戶收集使用反饋
3. **持續改進**：根據反饋添加新功能
4. **擴展功能**：考慮添加更多 AI 模型或風格

---

**恭喜！您的 AI Product Studio 現在已經永久在線了！** 🎉

如有任何問題，請參考上方的常見問題部分或查閱相關文件。
